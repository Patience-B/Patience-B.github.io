<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Progress Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: white;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2em;
        }

        .tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 30px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        .tab-button {
            flex: 1;
            padding: 15px 20px;
            border: none;
            background: transparent;
            color: #666;
            font-weight: 500;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: 150px;
        }

        .tab-button.active {
            background: #667eea;
            color: white;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.2em;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-sublabel {
            color: #999;
            font-size: 0.8em;
            margin-top: 5px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .chart-title {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #333;
            font-weight: 600;
        }

        .chart-canvas {
            position: relative;
            height: 300px;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .insight-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .insight-card.strengths {
            border-left: 5px solid #28a745;
        }

        .insight-card.improvements {
            border-left: 5px solid #dc3545;
        }

        .insight-card.recommendations {
            border-left: 5px solid #ffc107;
        }

        .insight-title {
            font-size: 1.3em;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .insight-list {
            list-style: none;
            padding: 0;
        }

        .insight-list li {
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .insight-list li:last-child {
            border-bottom: none;
        }

        .goal-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .goal-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .goal-achieved {
            background: #d4edda;
            color: #155724;
        }

        .goal-missed {
            background: #f8d7da;
            color: #721c24;
        }

        .weekly-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .week-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .week-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }

        .week-stats {
            display: grid;
            gap: 8px;
        }

        .week-stat {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
        }

        .accomplishments {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .accomplishment-item {
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .accomplishment-date {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .insights-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab-button {
                min-width: auto;
                flex: none;
                padding: 10px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Personal Goals Dataset Analysis</h1>
            <p>Comprehensive analysis of your daily goal tracking from August 18 - September 2, 2025</p>
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="showTab('overview')">Overview</button>
            <button class="tab-button" onclick="showTab('trends')">Daily Trends</button>
            <button class="tab-button" onclick="showTab('weekly')">Weekly Summary</button>
            <button class="tab-button" onclick="showTab('insights')">Insights & Recommendations</button>
        </div>

        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">16</div>
                    <div class="stat-label">Days Tracked</div>
                    <div class="stat-sublabel">Aug 18 - Sep 1, 2025</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avgBible">0</div>
                    <div class="stat-label">Avg Bible Verses</div>
                    <div class="stat-sublabel">Goal: 14/day (100/week)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avgSteps">0</div>
                    <div class="stat-label">Avg Steps</div>
                    <div class="stat-sublabel">Goal: 7,000/day</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="screenTimeExceed">0%</div>
                    <div class="stat-label">Screen Time Issues</div>
                    <div class="stat-sublabel">Goal exceeded days</div>
                </div>
            </div>

            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-title">Goal Achievement Rates</div>
                    <div class="chart-canvas">
                        <canvas id="achievementChart"></canvas>
                    </div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Average Daily Performance vs Goals</div>
                    <div class="goal-comparison" id="goalComparison"></div>
                </div>
            </div>
        </div>

        <!-- Trends Tab -->
        <div id="trends" class="tab-content">
            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-title">Daily Bible Study Progress (Goal: 14 verses/day)</div>
                    <div class="chart-canvas">
                        <canvas id="bibleChart"></canvas>
                    </div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Evening Walks - Steps (Goal: 7,000)</div>
                    <div class="chart-canvas">
                        <canvas id="stepsChart"></canvas>
                    </div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Screen Time vs Goal (3 Hours Max)</div>
                    <div class="chart-canvas">
                        <canvas id="screenTimeChart"></canvas>
                    </div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Portfolio Work Hours (Goal: 1 hour/day)</div>
                    <div class="chart-canvas">
                        <canvas id="portfolioChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Weekly Tab -->
        <div id="weekly" class="tab-content">
            <div class="chart-container">
                <div class="chart-title">Weekly Totals Comparison</div>
                <div class="chart-canvas">
                    <canvas id="weeklyChart"></canvas>
                </div>
            </div>
            <div class="weekly-grid" id="weeklyStats"></div>
        </div>

        <!-- Insights Tab -->
        <div id="insights" class="tab-content">
            <div class="insights-grid">
                <div class="insight-card strengths">
                    <div class="insight-title">üéØ Strengths</div>
                    <ul class="insight-list">
                        <li><strong>Bible Study Consistency:</strong> Active tracking every single day</li>
                        <li><strong>High Achievement Days:</strong> Aug 18 (99 verses) and Aug 25 (161 verses)</li>
                        <li><strong>Step Goals:</strong> Achieved 47% of the time when walking</li>
                        <li><strong>Portfolio Focus:</strong> 3 days with solid 2+ hour work sessions</li>
                        <li><strong>Data Tracking:</strong> Excellent commitment to monitoring progress</li>
                    </ul>
                </div>

                <div class="insight-card improvements">
                    <div class="insight-title">‚ö†Ô∏è Areas for Improvement</div>
                    <ul class="insight-list">
                        <li><strong>Screen Time:</strong> Consistently exceeding 3-hour goal (avg: 6.4 hrs)</li>
                        <li><strong>Sand Time:</strong> Only achieved 5-hour goal once (Aug 28)</li>
                        <li><strong>Portfolio Work:</strong> Only 19% achievement rate for daily goal</li>
                        <li><strong>Walking Consistency:</strong> Several days with 0 steps recorded</li>
                        <li><strong>Bible Study:</strong> Very inconsistent daily amounts</li>
                    </ul>
                </div>

                <div class="insight-card recommendations">
                    <div class="insight-title">üí° Recommendations</div>
                    <ul class="insight-list">
                        <li><strong>Screen Time:</strong> Set app timers and create phone-free zones</li>
                        <li><strong>Bible Study:</strong> Aim for 14-15 verses daily vs. variable amounts</li>
                        <li><strong>Portfolio:</strong> Schedule 2-hour morning blocks consistently</li>
                        <li><strong>Exercise:</strong> Set minimum 4,000 steps on non-walk days</li>
                        <li><strong>Weekly Planning:</strong> Create structured schedule for all activities</li>
                    </ul>
                </div>
            </div>

            <div class="accomplishments">
                <h3 style="margin-bottom: 20px; font-size: 1.4em;">üìù Daily Accomplishments</h3>
                <div id="accomplishmentsList"></div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced dataset matching the React version
        const data = [
            { date: "18/08/2025", week: "18/08/2025", bible: 99, steps: 10000, sand: 3, portfolio: 0.5, screenTime: "8:34:00", accomplishment: "" },
            { date: "19/08/2025", week: "18/08/2025", bible: 28, steps: 7600, sand: 2.5, portfolio: 0, screenTime: "2:09:00", accomplishment: "Went for lunch with Charity at T-star Talked with Timothy for almost 2 hours" },
            { date: "20/08/2025", week: "18/08/2025", bible: 0, steps: 2000, sand: 3, portfolio: 0, screenTime: "6:25:00", accomplishment: "Picked Tasha from School" },
            { date: "21/08/2025", week: "18/08/2025", bible: 1, steps: 4000, sand: 2.5, portfolio: 0, screenTime: "6:23:00", accomplishment: "Attend Xplore Study with Timothy" },
            { date: "22/08/2025", week: "18/08/2025", bible: 56, steps: 4000, sand: 2, portfolio: 0, screenTime: "10:42:00", accomplishment: "Got my money issue sorted for July and August because Micaela reached out to me" },
            { date: "23/08/2025", week: "18/08/2025", bible: 0, steps: 5000, sand: 0, portfolio: 0, screenTime: "13:59:00", accomplishment: "Re-organized my room and picked up fixed chair" },
            { date: "24/08/2025", week: "18/08/2025", bible: 27, steps: 8500, sand: 0, portfolio: 0, screenTime: "3:27:00", accomplishment: "Went for Jonathan's last wedding meeting. Met Giki again. I still have a huge crash on him." },
            { date: "25/08/2025", week: "25/08/2025", bible: 161, steps: 0, sand: 2, portfolio: 0, screenTime: "4:12:00", accomplishment: "" },
            { date: "26/08/2025", week: "25/08/2025", bible: 0, steps: 4000, sand: 1, portfolio: 2, screenTime: "2:47:00", accomplishment: "Went for games" },
            { date: "27/08/2025", week: "25/08/2025", bible: 0, steps: 0, sand: 2, portfolio: 0, screenTime: "10:00:00", accomplishment: "" },
            { date: "28/08/2025", week: "25/08/2025", bible: 22, steps: 0, sand: 6, portfolio: 0, screenTime: "9:50:00", accomplishment: "" },
            { date: "29/08/2025", week: "25/08/2025", bible: 0, steps: 4000, sand: 4, portfolio: 0, screenTime: "4:11:00", accomplishment: "Spent a lovely evening with Matthew. Did a presentation at work." },
            { date: "30/08/2025", week: "25/08/2025", bible: 0, steps: 2000, sand: 0, portfolio: 0, screenTime: "5:31:00", accomplishment: "Went to visit the Jerry. That will be my last visit to that house in a very long while (potentially 5 years)" },
            { date: "31/08/2025", week: "25/08/2025", bible: 42, steps: 6500, sand: 1, portfolio: 0, screenTime: "4:58:00", accomplishment: "" },
            { date: "01/09/2025", week: "01/09/2025", bible: 15, steps: 7500, sand: 2, portfolio: 2, screenTime: "2:59:00", accomplishment: "Did a presentation for Precise conference" },
            { date: "02/09/2025", week: "01/09/2025", bible: 66, steps: 0, sand: 1.5, portfolio: 0, screenTime: "10:59:00", accomplishment: "" }
        ];

        // Goals
        const goals = {
            bible: 14, // ~100 verses per week / 7 days
            steps: 7000,
            sand: 5,
            portfolio: 1,
            screenTimeMax: 3
        };

        // Convert time to hours
        function timeToHours(timeStr) {
            if (!timeStr) return 0;
            const parts = timeStr.split(':');
            return parseInt(parts[0]) + parseInt(parts[1]) / 60 + parseInt(parts[2]) / 3600;
        }

        // Process data
        const processedData = data.map(row => ({
            ...row,
            screenHours: timeToHours(row.screenTime),
            dateFormatted: row.date.split('/').slice(0, 2).join('/'),
            dayMonth: new Date('20' + row.date.split('/')[2], row.date.split('/')[1] - 1, row.date.split('/')[0])
                .toLocaleDateString('en-GB', { month: 'short', day: 'numeric' })
        }));

        // Calculate statistics
        const stats = {
            avgBible: Math.round(processedData.reduce((sum, d) => sum + d.bible, 0) / processedData.length),
            avgSteps: Math.round(processedData.filter(d => d.steps > 0).reduce((sum, d) => sum + d.steps, 0) / processedData.filter(d => d.steps > 0).length),
            avgScreenHours: (processedData.reduce((sum, d) => sum + d.screenHours, 0) / processedData.length).toFixed(1),
            bibleGoalAchieved: processedData.filter(d => d.bible >= goals.bible).length,
            stepsGoalAchieved: processedData.filter(d => d.steps >= goals.steps).length,
            portfolioGoalAchieved: processedData.filter(d => d.portfolio >= goals.portfolio).length,
            screenTimeExceeded: processedData.filter(d => d.screenHours > goals.screenTimeMax).length,
            sandGoalAchieved: processedData.filter(d => d.sand >= goals.sand).length
        };

        // Update overview stats
        document.getElementById('avgBible').textContent = stats.avgBible;
        document.getElementById('avgSteps').textContent = stats.avgSteps.toLocaleString();
        document.getElementById('screenTimeExceed').textContent = Math.round(stats.screenTimeExceeded / processedData.length * 100) + '%';

        // Chart configurations
        Chart.defaults.font.family = "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif";
        Chart.defaults.color = '#666';

        // Goal Comparison
        const goalComparison = document.getElementById('goalComparison');
        const goalData = [
            { name: 'Bible Study', avg: stats.avgBible, goal: goals.bible, unit: 'verses' },
            { name: 'Evening Walks', avg: stats.avgSteps, goal: goals.steps, unit: 'steps' },
            { name: 'Portfolio Work', avg: (processedData.reduce((sum, d) => sum + d.portfolio, 0) / processedData.length).toFixed(1), goal: goals.portfolio, unit: 'hrs' },
            { name: 'Screen Time', avg: stats.avgScreenHours, goal: goals.screenTimeMax, unit: 'hrs', reverse: true }
        ];

        goalData.forEach(item => {
            const isAchieved = item.reverse ? 
                parseFloat(item.avg) <= item.goal : 
                parseFloat(item.avg) >= item.goal;
            
            const div = document.createElement('div');
            div.className = `goal-item ${isAchieved ? 'goal-achieved' : 'goal-missed'}`;
            div.innerHTML = `
                <span><strong>${item.name}:</strong></span>
                <span>${item.avg} / ${item.goal} ${item.unit}</span>
            `;
            goalComparison.appendChild(div);
        });

        // Achievement Chart
        const achievementCtx = document.getElementById('achievementChart').getContext('2d');
        new Chart(achievementCtx, {
            type: 'bar',
            data: {
                labels: ['Bible Study', 'Steps', 'Sand Time', 'Portfolio', 'Screen Time (‚â§3h)'],
                datasets: [{
                    label: 'Achievement Rate (%)',
                    data: [
                        Math.round(stats.bibleGoalAchieved / processedData.length * 100),
                        Math.round(stats.stepsGoalAchieved / processedData.filter(d => d.steps > 0).length * 100),
                        Math.round(stats.sandGoalAchieved / processedData.length * 100),
                        Math.round(stats.portfolioGoalAchieved / processedData.length * 100),
                        Math.round((processedData.length - stats.screenTimeExceeded) / processedData.length * 100)
                    ],
                    backgroundColor: [
                        '#8884d8',
                        '#82ca9d', 
                        '#ffc658',
                        '#ff7300',
                        '#ff6b6b'
                    ],
                    borderRadius: 6,
                    borderSkipped: false,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            callback: function(value) {
                                return value + '%';
                            }
                        }
                    }
                }
            }
        });

        // Bible Study Chart
        const bibleCtx = document.getElementById('bibleChart').getContext('2d');
        new Chart(bibleCtx, {
            type: 'line',
            data: {
                labels: processedData.map(d => d.dayMonth),
                datasets: [{
                    label: 'Bible Verses',
                    data: processedData.map(d => d.bible),
                    borderColor: '#8884d8',
                    backgroundColor: 'rgba(136, 132, 216, 0.1)',
                    fill: true,
                    tension: 0.4,
                    pointRadius: 4,
                    pointHoverRadius: 6
                }, {
                    label: 'Goal (14 verses)',
                    data: Array(processedData.length).fill(goals.bible),
                    borderColor: '#ff7300',
                    borderDash: [5, 5],
                    fill: false,
                    pointRadius: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    intersect: false,
                    mode: 'index'
                },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        // Steps Chart
        const stepsCtx = document.getElementById('stepsChart').getContext('2d');
        new Chart(stepsCtx, {
            type: 'line',
            data: {
                labels: processedData.map(d => d.dayMonth),
                datasets: [{
                    label: 'Steps',
                    data: processedData.map(d => d.steps),
                    borderColor: '#82ca9d',
                    backgroundColor: 'rgba(130, 202, 157, 0.1)',
                    fill: true,
                    tension: 0.4,
                    pointRadius: 4,
                    pointHoverRadius: 6
                }, {
                    label: 'Goal (7,000 steps)',
                    data: Array(processedData.length).fill(goals.steps),
                    borderColor: '#ff7300',
                    borderDash: [5, 5],
                    fill: false,
                    pointRadius: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    intersect: false,
                    mode: 'index'
                },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        // Screen Time Chart
        const screenTimeCtx = document.getElementById('screenTimeChart').getContext('2d');
        new Chart(screenTimeCtx, {
            type: 'bar',
            data: {
                labels: processedData.map(d => d.dayMonth),
                datasets: [{
                    label: 'Screen Time (hours)',
                    data: processedData.map(d => d.screenHours),
                    backgroundColor: processedData.map(d => d.screenHours > goals.screenTimeMax ? '#ff6b6b' : '#82ca9d'),
                    borderRadius: 4,
                    borderSkipped: false
                }, {
                    label: 'Goal (‚â§3 hours)',
                    data: Array(processedData.length).fill(goals.screenTimeMax),
                    type: 'line',
                    borderColor: '#ff7300',
                    borderDash: [5, 5],
                    fill: false,
                    pointRadius: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        // Portfolio Chart
        const portfolioCtx = document.getElementById('portfolioChart').getContext('2d');
        new Chart(portfolioCtx, {
            type: 'bar',
            data: {
                labels: processedData.map(d => d.dayMonth),
                datasets: [{
                    label: 'Portfolio Hours',
                    data: processedData.map(d => d.portfolio),
                    backgroundColor: processedData.map(d => d.portfolio >= goals.portfolio ? '#82ca9d' : '#ffc658'),
                    borderRadius: 4,
                    borderSkipped: false
                }, {
                    label: 'Goal (1 hour)',
                    data: Array(processedData.length).fill(goals.portfolio),
                    type: 'line',
                    borderColor: '#ff7300',
                    borderDash: [5, 5],
                    fill: false,
                    pointRadius: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        // Weekly Analysis
        const weeklyData = {};
        processedData.forEach(row => {
            if (!weeklyData[row.week]) {
                weeklyData[row.week] = {
                    bible: 0,
                    steps: 0,
                    sand: 0,
                    portfolio: 0,
                    screenHours: 0,
                    days: 0
                };
            }
            weeklyData[row.week].bible += row.bible;
            weeklyData[row.week].steps += row.steps;
            weeklyData[row.week].sand += row.sand;
            weeklyData[row.week].portfolio += row.portfolio;
            weeklyData[row.week].screenHours += row.screenHours;
            weeklyData[row.week].days += 1;
        });

        const weeklyArray = Object.entries(weeklyData).map(([week, data]) => ({
            week: `Week of ${new Date('20' + week.split('/')[2], week.split('/')[1] - 1, week.split('/')[0])
                .toLocaleDateString('en-GB', { month: 'short', day: 'numeric' })}`,
            ...data,
            screenHours: Math.round(data.screenHours * 10) / 10
        }));

        // Weekly Chart
        const weeklyCtx = document.getElementById('weeklyChart').getContext('2d');
        new Chart(weeklyCtx, {
            type: 'bar',
            data: {
                labels: weeklyArray.map(w => w.week),
                datasets: [{
                    label: 'Bible Verses',
                    data: weeklyArray.map(w => w.bible),
                    backgroundColor: '#8884d8',
                    yAxisID: 'y'
                }, {
                    label: 'Steps (√∑100)',
                    data: weeklyArray.map(w => Math.round(w.steps / 100)),
                    backgroundColor: '#82ca9d',
                    yAxisID: 'y'
                }, {
                    label: 'Sand Hours',
                    data: weeklyArray.map(w => w.sand),
                    backgroundColor: '#ffc658',
                    yAxisID: 'y'
                }, {
                    label: 'Portfolio Hours',
                    data: weeklyArray.map(w => w.portfolio),
                    backgroundColor: '#ff7300',
                    yAxisID: 'y'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top'
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                if (context.dataset.label === 'Steps (√∑100)') {
                                    return `Steps: ${(context.parsed.y * 100).toLocaleString()}`;
                                }
                                return `${context.dataset.label}: ${context.parsed.y}`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Week'
                        }
                    },
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Values (Steps √∑ 100)'
                        }
                    }
                }
            }
        });

        // Weekly Stats Cards
        const weeklyStatsContainer = document.getElementById('weeklyStats');
        weeklyArray.forEach(week => {
            const card = document.createElement('div');
            card.className = 'week-card';
            card.innerHTML = `
                <div class="week-title">${week.week} (${week.days} days)</div>
                <div class="week-stats">
                    <div class="week-stat">
                        <span>Bible Study:</span>
                        <span><strong>${week.bible} verses</strong></span>
                    </div>
                    <div class="week-stat">
                        <span>Steps:</span>
                        <span><strong>${week.steps.toLocaleString()}</strong></span>
                    </div>
                    <div class="week-stat">
                        <span>Sand Time:</span>
                        <span><strong>${week.sand} hours</strong></span>
                    </div>
                    <div class="week-stat">
                        <span>Portfolio:</span>
                        <span><strong>${week.portfolio} hours</strong></span>
                    </div>
                    <div class="week-stat">
                        <span>Screen Time:</span>
                        <span style="color: ${week.screenHours > goals.screenTimeMax * week.days ? '#dc3545' : '#28a745'}">
                            <strong>${week.screenHours} hours</strong>
                        </span>
                    </div>
                </div>
            `;
            weeklyStatsContainer.appendChild(card);
        });

        // Display accomplishments
        const accomplishmentsList = document.getElementById('accomplishmentsList');
        const accomplishments = data.filter(d => d.accomplishment.trim() !== '');
        
        accomplishments.reverse().forEach(item => {
            const div = document.createElement('div');
            div.className = 'accomplishment-item';
            div.innerHTML = `
                <div class="accomplishment-date">${item.date}</div>
                <div>${item.accomplishment}</div>
            `;
            accomplishmentsList.appendChild(div);
        });

        // Tab functionality
        function showTab(tabName) {
            // Hide all tab contents
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));
            
            // Remove active class from all buttons
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(button => button.classList.remove('active'));
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');

            // Resize charts when tab becomes visible
            setTimeout(() => {
                Chart.helpers.each(Chart.instances, function(instance) {
                    instance.resize();
                });
            }, 100);
        }

        // Make showTab globally available
        window.showTab = showTab;

        // Initialize charts resize on window resize
        window.addEventListener('resize', () => {
            Chart.helpers.each(Chart.instances, function(instance) {
                instance.resize();
            });
        });
    </script>
</body>
</html>
